<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÊà∑Â§ñËΩ®Ëøπ - My Interests</title>
    
    <!-- ÂºïÂÖ•Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #fff;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .map-container {
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        #map {
            height: 500px;
            width: 100%;
        }
        
        .info-panel {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #e74c3c;
        }
        
        .status {
            font-weight: 500;
            color: #2c3e50;
        }
        
        .back-link {
            display: inline-block;
            margin: 20px 0;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
        }
        
        .back-link:hover {
            background: #2980b9;
        }
        
        .error {
            color: #e74c3c;
            background: #fdf2f2;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #fecaca;
        }
        
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            
            #map {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèÉ‚Äç‚ôÇÔ∏è My Cycling Tracks</h1>
        <p>Recording every cycling footprint</p>
        <a href="https://zhucy-99.github.io/academicpage/" class="back-link">‚Üê Back to Home</a>
    </div>
    
    <div class="map-container">
        <div id="map"></div>
    </div>
    
    <div class="info-panel">
        <h3>Track Information</h3>
        <div class="status" id="status">Loading map...</div>
    </div>
    
    <!-- ÂºïÂÖ•Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- ÂºïÂÖ•GPXÊèí‰ª∂ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.7.0/gpx.min.js"></script>
    
    <script>
        let map;
        let allBounds = [];
        
        // GPXÊñá‰ª∂ÂàóË°®
        const gpxFiles = [
            '20241201not_outdoor_run_class_0.gpx',
            '20250124not_outdoor_run_class_0.gpx',
            '20250130not_outdoor_run_class_0.gpx',
            '20250306not_outdoor_run_class_0.gpx',
            '20250307not_outdoor_run_class_0.gpx',
            '20250308not_outdoor_run_class_0.gpx',
            '20250309not_outdoor_run_class_0.gpx',
            '20250310not_outdoor_run_class_0.gpx',
            '20250310not_outdoor_run_class_1.gpx',
            '20250311not_outdoor_run_class_0.gpx',
            '20250312not_outdoor_run_class_0.gpx',
            '20250316not_outdoor_run_class_0.gpx',
            '20250317not_outdoor_run_class_0.gpx',
            '20250318not_outdoor_run_class_0.gpx',
            '20250318not_outdoor_run_class_1.gpx',
            '20250319not_outdoor_run_class_0.gpx',
            '20250320not_outdoor_run_class_0.gpx',
            '20250320not_outdoor_run_class_1.gpx',
            '20250321not_outdoor_run_class_0.gpx',
            '20250322not_outdoor_run_class_0.gpx',
            '20250323not_outdoor_run_class_0.gpx',
            '20250324not_outdoor_run_class_0.gpx',
            '20250325not_outdoor_run_class_0.gpx',
            '20250325not_outdoor_run_class_1.gpx',
            '20250326not_outdoor_run_class_0.gpx',
            '20250327not_outdoor_run_class_0.gpx',
            '20250328not_outdoor_run_class_0.gpx',
            '20250329not_outdoor_run_class_0.gpx',
            '20250330not_outdoor_run_class_0.gpx',
            '20250331outdoor_run_class_0.gpx',
            '20250331outdoor_run_class_1.gpx',
            '20250401not_outdoor_run_class_0.gpx',
            '20250402not_outdoor_run_class_0.gpx',
            '20250403not_outdoor_run_class_0.gpx',
            '20250404not_outdoor_run_class_0.gpx',
            '20250406not_outdoor_run_class_0.gpx',
            '20250407not_outdoor_run_class_0.gpx',
            '20250408not_outdoor_run_class_0.gpx',
            '20250409not_outdoor_run_class_0.gpx',
            '20250410not_outdoor_run_class_0.gpx',
            '20250411not_outdoor_run_class_0.gpx',
            '20250414not_outdoor_run_class_0.gpx',
            '20250416not_outdoor_run_class_0.gpx',
            '20250416not_outdoor_run_class_1.gpx',
            '20250417not_outdoor_run_class_0.gpx',
            '20250419not_outdoor_run_class_0.gpx',
            '20250424not_outdoor_run_class_0.gpx',
            '20250425not_outdoor_run_class_0.gpx',
            '20250425not_outdoor_run_class_1.gpx',
            '20250426not_outdoor_run_class_0.gpx',
            '20250427not_outdoor_run_class_0.gpx',
            '20250428not_outdoor_run_class_0.gpx',
            '20250429not_outdoor_run_class_0.gpx',
            '20250430not_outdoor_run_class_0.gpx',
            '20250501not_outdoor_run_class_0.gpx',
            '20250502not_outdoor_run_class_0.gpx',
            '20250503not_outdoor_run_class_0.gpx',
            '20250504not_outdoor_run_class_0.gpx',
            '20250507not_outdoor_run_class_0.gpx',
            '20250508not_outdoor_run_class_0.gpx',
            '20250517not_outdoor_run_class_0.gpx',
            '20250517not_outdoor_run_class_1.gpx',
            '20250518not_outdoor_run_class_0.gpx',
            '20250523not_outdoor_run_class_0.gpx',
            '20250523not_outdoor_run_class_1.gpx',
            '20250523not_outdoor_run_class_2.gpx',
            '20250526not_outdoor_run_class_0.gpx',
            '20250531not_outdoor_run_class_0.gpx',
            '20250531not_outdoor_run_class_1.gpx',
            '20250531not_outdoor_run_class_2.gpx',
            '20250531not_outdoor_run_class_3.gpx',
            '20250601not_outdoor_run_class_0.gpx',
            '20250601not_outdoor_run_class_1.gpx',
            '20250602not_outdoor_run_class_0.gpx',
            '20250607outdoor_run_class_0.gpx',
            '20250611not_outdoor_run_class_0.gpx',
            '20250615not_outdoor_run_class_0.gpx',
            '20250615not_outdoor_run_class_1.gpx',
            '20250623not_outdoor_run_class_0.gpx',
            '20250623not_outdoor_run_class_1.gpx',
            '20250624not_outdoor_run_class_0.gpx',
            '20250625not_outdoor_run_class_0.gpx',
            '20250628not_outdoor_run_class_0.gpx',
            '20250701not_outdoor_run_class_0.gpx',
            '20250702not_outdoor_run_class_0.gpx',
            '20250703not_outdoor_run_class_0.gpx',
            '20250705not_outdoor_run_class_0.gpx',
            '20250706not_outdoor_run_class_0.gpx',
            '20250707not_outdoor_run_class_0.gpx',
            '20250707not_outdoor_run_class_1.gpx',
            '20250709not_outdoor_run_class_0.gpx',
            '20250710not_outdoor_run_class_0.gpx',
            '20250711not_outdoor_run_class_0.gpx',
            '20250713not_outdoor_run_class_0.gpx',
            '20250714not_outdoor_run_class_0.gpx',
            '20250716not_outdoor_run_class_0.gpx',
            '20250719not_outdoor_run_class_0.gpx',
            '20250720not_outdoor_run_class_0.gpx',
            '20250723not_outdoor_run_class_0.gpx',
            '20250725not_outdoor_run_class_0.gpx',
            '20250727outdoor_run_class_0.gpx',
            '20250731not_outdoor_run_class_0.gpx',
            '20250801not_outdoor_run_class_0.gpx',
            '20250804not_outdoor_run_class_0.gpx',
            '20250804not_outdoor_run_class_1.gpx',
            '20250810not_outdoor_run_class_0.gpx',
            '20250810not_outdoor_run_class_1.gpx',
            '20250811not_outdoor_run_class_0.gpx',
            '20250814not_outdoor_run_class_0.gpx'
        ];
        
        function updateStatus(message, isError = false) {
            const statusDiv = document.getElementById('status');
            console.log(message);
            statusDiv.innerHTML = message;
            if (isError) {
                statusDiv.className = 'status error';
            } else {
                statusDiv.className = 'status';
            }
        }
        
        function parseFileName(filename) {
            const match = filename.match(/(\d{8})/);
            if (match) {
                const date = match[1];
                const year = date.substring(0, 4);
                const month = date.substring(4, 6);
                const day = date.substring(6, 8);
                return `${year}-${month}-${day}`;
            }
            return filename;
        }
        
        function getTrackColor() {
            return '#e74c3c'; // Áªü‰∏Ä‰ΩøÁî®Á∫¢Ëâ≤
        }
        
        function initMap() {
            updateStatus('üó∫Ô∏è Initializing map...');
            
            try {
                // Create map instance
                map = L.map('map').setView([39.9042, 116.4074], 13);
                
                // Add OpenStreetMap layer
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                }).addTo(map);
                
                // Add scale control
                L.control.scale().addTo(map);
                
                updateStatus('‚úÖ Base map loaded successfully! Loading GPX tracks...');
                
                // Load all GPX files
                loadAllGPXTracks();
                
            } catch (error) {
                updateStatus('‚ùå Map initialization failed: ' + error.message, true);
                console.error('Map initialization error:', error);
            }
        }
        
        function loadAllGPXTracks() {
            let loadedCount = 0;
            let successCount = 0;
            
            updateStatus(`üì• Starting to load ${gpxFiles.length} tracks...`);
            
            gpxFiles.forEach((filename, index) => {
                const gpxUrl = `https://zhucy-99.github.io/academicpage/gpx/${filename}`;
                const displayDate = parseFileName(filename);
                
                try {
                    const gpx = new L.GPX(gpxUrl, {
                        async: true,
                        parseElements: ['track'],
                        marker_options: {
                            startIcon: L.divIcon({
                                className: 'start-marker',
                                html: '<div style="background-color: #f39c12; width: 8px; height: 8px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
                                iconSize: [12, 12],
                                iconAnchor: [6, 6]
                            }),
                            endIcon: L.divIcon({
                                className: 'end-marker',
                                html: '<div style="background-color: #e74c3c; width: 8px; height: 8px; border-radius: 50%; border: 2px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3);"></div>',
                                iconSize: [12, 12],
                                iconAnchor: [6, 6]
                            }),
                            shadowUrl: null,
                            wptIcons: null
                        },
                        polyline_options: {
                            color: '#e74c3c',
                            weight: 3,
                            opacity: 0.7,
                            smoothFactor: 1.0
                        }
                    });
                    
                    gpx.on('loaded', function(e) {
                        successCount++;
                        loadedCount++;
                        
                        // Êî∂ÈõÜËæπÁïåÁî®‰∫éÊúÄÁªàÁöÑÂú∞ÂõæËßÜÂõæË∞ÉÊï¥
                        allBounds.push(e.target.getBounds());
                        
                        // Get track statistics
                        const distance = this.get_distance ? (this.get_distance() / 1000).toFixed(2) : 'Unknown';
                        
                        // Set popup window
                        this.bindPopup(`
                            <div style="text-align: center; min-width: 200px;">
                                <h4 style="margin: 0 0 10px 0; color: #e74c3c;">üèÉ‚Äç‚ôÇÔ∏è Running Track</h4>
                                <p><strong>Date:</strong> ${displayDate}</p>
                                <p><strong>Distance:</strong> ${distance} km</p>
                            </div>
                        `);
                        
                        // Update progress
                        updateStatus(`üìä Loaded ${successCount}/${gpxFiles.length} tracks`);
                        
                        // If this is the last file loaded
                        if (loadedCount === gpxFiles.length) {
                            finishLoading();
                        }
                    });
                    
                    gpx.on('error', function(e) {
                        loadedCount++;
                        console.error(`Failed to load ${filename}:`, e);
                        
                        updateStatus(`‚ö†Ô∏è Processed ${loadedCount}/${gpxFiles.length} files, ${successCount} successful`);
                        
                        if (loadedCount === gpxFiles.length) {
                            finishLoading();
                        }
                    });
                    
                    gpx.addTo(map);
                    
                } catch (error) {
                    loadedCount++;
                    console.error(`Error processing ${filename}:`, error);
                    
                    if (loadedCount === gpxFiles.length) {
                        finishLoading();
                    }
                }
            });
        }
        
        function finishLoading() {
            updateStatus(`üéâ Loading complete! Successfully displayed ${allBounds.length} tracks`);
            
            // Adjust map view to show all tracks
            if (allBounds.length > 0) {
                const group = new L.featureGroup();
                allBounds.forEach(bounds => {
                    L.rectangle(bounds).addTo(group);
                });
                map.fitBounds(group.getBounds(), { padding: [20, 20] });
                group.clearLayers();
            }
        }
        
        // Load page and initialize map
        window.addEventListener('load', function() {
            setTimeout(initMap, 500);
        });
        
        // Backup initialization method
        document.addEventListener('DOMContentLoaded', function() {
            if (document.readyState === 'complete') {
                setTimeout(initMap, 1000);
            }
        });
    </script>
</body>
</html>
